<!DOCTYPE html>
<html>
    <meta charset="UTF-8">
    <head>
        <link rel="icon" type="image/png" href="/favicon.png">
        <style>
                body {
                    background-color: #0D0221;
                    margin: 0;
                    padding: 0;
                    color: rgb(245, 245, 245);
                }

                ul.menubar {
                    list-style-type: none;
                    margin: 0;
                    padding: 0;
                    overflow: hidden;
                    background-color: #333;
                    
                }

                ul.menubar > li {
                    float: left;
                }

                li.dropdown > a, .dropbtn {
                    display: inline-block;
                    color: white;
                    padding: 16px;
                    text-decoration: none;
                    font-size: 16px;
                    height: 48px;
                }

                ul.menubar > li > a:hover, .dropdown:hover .dropbtn {
                    background-color: rgb(80, 80, 80);
                }

                ul.menubar > li.dropdown {
                    display: inline-block;
                }

                .dropdown-content {
                    display: none;
                    position: absolute;
                    background-color: rgb(80, 80, 80);
                    min-width: 160px;
                    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
                    z-index: 1;
                }
                a {
                    color:rgb(167, 166, 166);
                }
                .dropdown-content a {
                    padding: 12px 16px;
                    text-decoration: none;
                    display: block;
                    text-align: left;
                    color: white;
                }

                .dropdown-content a:hover {
                    background-color: rgb(100, 100, 100);
                }

                .dropdown:hover .dropdown-content {
                    display: block;
                }
                .noselect {
                    -webkit-touch-callout: none; /* iOS Safari */
                        -webkit-user-select: none; /* Safari */
                        -khtml-user-select: none; /* Konqueror HTML */
                        -moz-user-select: none; /* Firefox */
                            -ms-user-select: none; /* Internet Explorer/Edge */
                                user-select: none; /* Non-prefixed version, currently
                                                    supported by Chrome and Opera */
                    }
                .content{
                    margin: 10px;
                    padding: 0px;
                    max-width: 800px;
                }

                .block{
                    border: solid rgb(36, 4, 94);
                    background-color: rgb(25, 4, 66);
                    border-radius: 5px;
                    margin: 0px auto;
                    padding:  10px;
                    margin-bottom: 10px;
                    margin-right: 10px;
                    padding-right: 10px;
                 
                }
                .block > h3{
                    margin: 0;
                    padding: 0;
                }
                .block > p{
                    margin: 0;
                    padding: 0;
                    padding-right: 15px;
                    position: relative;
                    left:15px;
                }
                .nav  a{
                    display: inline-block;
                    padding: 0;
                    margin: 0;
                    padding-right: 10px;
                }
                .nav h2{
                    padding: 0;
                    margin: 0;    
                }
                .a_no {
                    text-decoration: none;
                }
                pre {
                    border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;
                }
                table {
                font-family: arial, sans-serif;
                border-collapse: collapse;
                width: 100%;
                }

                td, th {
                border: 1px solid rgb(54, 16, 122);
                text-align: left;
                padding: 8px;
                }

                tr:nth-child(even) {
                background-color: #0D0221;
                }
        </style>
    </head>
    <body>
        <div class="noselect">
            <ul class="menubar">
                <li class="dropdown"><a href="/"><image src="/home.png" alt="Home" height="48px" style="padding-right:10px;"/></a></li>
                <li class="dropdown"><a href="/Bio/"><p>Bio</p></a></li>
                <li class="dropdown">
                    <a href = "/projects/Radio Lab/" class="dropbtn"><p>Lab Projects</p></a>
                    <div class="dropdown-content">
                        <a href='/projects/Radio Lab/Final/'/><p>Final</p></a><a href='/projects/Radio Lab/LAB 2/'/><p>LAB 2</p></a><a href='/projects/Radio Lab/LAB 1/'/><p>LAB 1</p></a>
                    </div>
                </li>
                <li class="dropdown">
                    <a href = "/projects/" class="dropbtn"><p>Projects</p></a>
                    <div class="dropdown-content">
                        <a href='/projects/Web Server/'/><p>Web Server</p></a><a href='/projects/VHDL/'/><p>VHDL</p></a><a href='/projects/Radio Lab/'/><p>Radio Lab</p></a>
                    </div>
                </li>
                <li class="dropdown"><a href="/projects/Radio Lab/Final/"><p>Final Project</p></a></li>
            </ul>
        </div>
        <div class="content">

<title>294: VHDL</title>
<H1>
    VHDL development setup
</H1>
<!--<div class="block nav">
<h2>
<a href="#intro">Intro</a>
<a href="#git">Github</a>
<a href="#http">HTTP</a>
</h2>
</div>-->
<div class="block">
    <H3 id="intro">Introduction</H3>
    <p>
        This is just describing the steps to setup my VHDL development and simulation enviroment. I'll be using will be VS code as my IDE, emacs as my styler and GHDL as my simulator and error checker. 
        This isn't gaurunteed to work, but it did work once.
    </p>
</div>
<div class="block">
<H3 id="git">Compiling GHDL</H3>
<p>
To get VScode integration working, currently GHDL has to be compiled from source. There are a few backends that are supported but I lean towards GCC due to speed.

Below are the build steps:
<pre><code>
sudo apt install npm
svn co svn://gcc.gnu.org/svn/gcc/branches/gcc-9-branch/ gcc
git clone https://github.com/ghdl/ghdl
git clone https://github.com/ghdl/ghdl-language-server
cd ghdl
mkdir build
cd build
../configure --with-gcc=../../gcc --prefix=/usr/local --enable-python
make copy-sources
mkdir gcc-objs
cd gcc-objs
unset LIBRARY_PATH CPATH C_INCLUDE_PATH PKG_CONFIG_PATH CPLUS_INCLUDE_PATH INCLUDE LD_LIBRARY_PATH
../../../gcc/configure --prefix=/usr/local --enable-languages=c,vhdl \
--disable-bootstrap --disable-lto --disable-multilib --disable-libssp \
--disable-libgomp --disable-libquadmath 
make -j8
sudo make install
cd ..
make ghdllib
sudo make install
cd ..
cd python
pip3 install .
cd ..
cd ..
cd ghdl-language-server
cd ghdl-ls
pip3 install .
cd ..
npm install -g vsce
cd vscode-client
vsce package
code --install-extension vhdl-lsp-*.vsix
</code></pre>

Then put the code below in a file anywhere. I prefer /usr/bin/vf
<pre><code>
#!/bin/sh
for i in '$@'
do
    emacs -batch $i --eval '(vhdl-beautify-buffer)' -f save-buffer
    rm $i~
    #echo $i >> /home/twoninefour/gay.txt
done
</code></pre>
Install the vscode extension emeraldwalk.runonsave, add the code below to settings.json either for your project or for global vscode settings
<pre><code>
"emeraldwalk.runonsave": {
    "commands": [
        {
            "match": "\\.vhdl$",
            "isAsync": false,
            "cmd": "vf ${file}"
        }
    ]
}
</code></pre>
Each project needs a file name hdl-prj.json in its main directory. The format is below
<pre><code>
{
    "options": {
        "ghdl_analysis": [
        ]
    },
    "files": [
        { "file": "src/pwm_tb.vhdl", "language": "vhdl" },
        { "file": "src/pwm.vhdl", "language": "vhdl" },
        { "file": "src/heartbeat.vhdl", "language": "vhdl" },
        { "file": "src/freqcomb.vhdl", "language": "vhdl" },
        { "file": "src/freqgen.vhdl", "language": "vhdl" }

    ]
}
</code></pre>
To use GHDL you need to analyze every file with ghdl -a filename first. Then elaborate on your top level one with ghdl -e module_name and then run the executable generated with various parameters. A sample Makefile is below
<pre><code>
default: pwm
pwm:
        ghdl -m pwm_tb
        ghdl -e pwm_tb
        ./pwm_tb --stop-time=5ms --wave=wave.ghw
graph:  pwm
        gtkwave wave.ghw 
</code></pre>
    </p>
</div>


</div>
</body>
</html>